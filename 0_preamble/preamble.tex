% !TEX root = ../main.tex
\KOMAoptions{
    headings=standardclasses,
    bibliography=totoc,
    toc=indentunnumbered,
    usegeometry
}

%%% FIX
\let\ifstr\Ifstr

%%% GEO
% \usepackage[bottom=3.5cm, inner=2.5cm,outer=3.5cm, marginpar=3.5cm, includeheadfoot]{geometry} % NEL CASO b5paper
\usepackage[bottom=3.5cm, inner=3.5cm,outer=4.5cm, marginpar=3.5cm, includeheadfoot]{geometry} % NEL CASO a4paper

%% Pagestcyle
\usepackage[automark]{scrlayer-scrpage}
\pagestyle{scrheadings}
\lehead{\thepage \qquad \leftmark}
\rohead{\rightmark \qquad \thepage}
\ofoot{}

%%% LANGUAGE AND FONT
\usepackage{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\usepackage[babel=true]{microtype}
\usepackage{helvet}
\usepackage{mathpazo}


\usepackage{amsmath,amssymb,amsfonts}
\usepackage[makeroom]{cancel}
\usepackage{siunitx}
\usepackage{physics}
% SIUNITX
\sisetup{
    per-mode=symbol,
    separate-uncertainty=true,
    range-units=single,
    range-phrase=\text{\ to\ }
}


\usepackage[numbers, sort&compress]{natbib}
\usepackage[american, useregional]{datetime2}

\usepackage[pagebackref=true]{hyperref}
% Hyperref setup, hidelinks in definition.
\hypersetup{
    pdfauthor={M Sotgia <mattia.sotgia@ge.infn.it>},
    pdfcreator={Latex/UNIGE (\DTMnow)},
    pdftitle={Opening Pandora's box},
    pdfsubject={A dedicated study of the automatic event reconstruction in the ICARUS experiment}
}
\usepackage{lastpage}
\usepackage[figure,table]{totalcount}

\usepackage[dvipsnames]{xcolor}

\usepackage{graphicx}
\graphicspath{{thesis/6_figures/}}
\usepackage{marginnote}
\usepackage[some]{background}
\usepackage{subfig}
\usepackage{sidecap}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{multirow}

\usepackage{rotating}

\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{tikz-feynman}
% Tikz libraries
\usetikzlibrary{calc, angles, arrows, arrows.meta, quotes}
\pgfplotsset{compat=1.18}


% Table of contents style
\RedeclareSectionCommands[%
  toclinefill={,\qquad},%
  tocraggedpagenumber,%
  tocpagenumberbox=\mbox,
]{part,chapter,section, subsection, subsubsection}

\RedeclareSectionCommands[%
    tocdynindent,
    tocindentfollows=chapter
]{section}

\RedeclareSectionCommands[%
    tocdynindent,
    tocindentfollows=section
]{subsection}

\RedeclareSectionCommands[%
    tocdynindent,
    tocindentfollows=subsection
]{subsubsection}

\addtokomafont{chapterentry}{\mdseries}
\DeclareTOCStyleEntry[
  entrynumberformat=\bfseries\sffamily,
  dynnumwidth
]{chapter}{chapter}
\let\oldaddchaptertocentry\addchaptertocentry
\renewcommand{\addchaptertocentry}[2]{%
    \ifstr{#1}{}{%
        \oldaddchaptertocentry{#1}{#2}}{%
        \oldaddchaptertocentry{\chapapp{} #1}{#2}%
}}


% update \appendix definition
\let\oldappendix\appendix
\renewcommand{\appendix}{
\oldappendix
\counterwithin{equation}{chapter}
\counterwithin{figure}{chapter}
\counterwithin{table}{chapter}
}

% Figures and tables style
\setcapindent{0pt}
\addtokomafont{captionlabel}{\bfseries}
\renewcommand*{\captionformat}{\ }



% Chapter style
% \renewcommand{\thechapter}{\Roman{chapter}}
% \renewcommand{\thesection}{\normalfont \arabic{section}} % Workaraund
% \addtokomafont{subsection}{\normalfont\itshape}
% \addtokomafont{chapter}{\MakeUppercase}

% Marginnotes
% \renewcommand{\marginfont}{\sffamily\small}
% \newcommand{\note}[1]{\marginnote{
% \colorbox{yellow}{\begin{minipage}{\marginparwidth}
% #1
% \end{minipage}}
% }}

% \usepackage{showframe}

% Background WM
\backgroundsetup{
    % position={-1.5cm,-16cm},
    position={-1.5cm,-13cm},
    color=black, opacity=1, scale=1,
    angle=90
}
\SetBgContents{
    % \hspace{0.1cm}
    \begin{minipage}[b]{8cm}
        \fontfamily{ptm}\selectfont
        UNIGE / FNAL / THESIS-\the\year-\the\month\\
        \DTMNow\
        (\pageref{LastPage} pp, \totalfigures\ figs.)
    \end{minipage}\includegraphics[height=1cm]{6_figures/FNAL/FNAL-Logo-Black}
}

% bibliography pageref

\renewcommand*{\backref}[1]{}
\renewcommand*{\backrefalt}[4]{
    % \color{gray}
    \color{chaptergrey}
    \ifcase #1 (Not cited.)%
          \or{Cited on p. #2}%
          \else{Cited on pp. #2}%
    \fi%
}

\renewcommand\bibnumfmt[1]{#1.}
\urlstyle{sf}

% dictum redefinitions
% \setkomafont{dictum}{\normalfont}
\renewcommand*\dictumwidth{0.45\linewidth}

% Title and other strong commands definitions

\DeclareRobustCommand\title[1]{
\gdef\@title{#1}
}

% \usepackage[Lenny]{fncychap}
\usepackage[utopia]{quotchap}

\makeatletter 
\renewcommand*{\sectfont}{\bfseries}
\renewcommand*{\chapnumfont}{%
% \usefont{T1}{\@defaultcnfont}{b}{n}\fontsize{130}{160}\selectfont% Default: 100/130
\usefont{T1}{phv}{b}{n}\fontsize{100}{130}\selectfont% Default: 100/130
\color{chaptergrey}%
\phantom{0}% This fixes chapter w/o number
}
\makeatother
\addtokomafont{chapter}{\usefont{T1}{phv}{b}{n}\selectfont}
% \addtokomafont{section}{\sffamily}
% \addtokomafont{subsection}{\sffamily}
% \addtokomafont{subsubsection}{\sffamily}

\definecolor{chaptergrey}{rgb}{0.6862745098,0.1529411765,0.1843137255}
\colorlet{chaptergrey}{PineGreen}
\definecolor{chaptergrey}{rgb}{0.2980392157,0.5490196078,0.168627451} % 76, 140, 43
\colorlet{chaptergrey}{NavyBlue}

\hypersetup{colorlinks, allcolors=chaptergrey}

\newenvironment{abstract}
    {%
    \cleardoublepage
    \phantom{.}\par%
    \vfill\par%
    \begin{center}
    {\bfseries Abstract}
    \end{center}
    }
    {%
    \par%
    \vfill\vfill\phantom{.}
    }

\usepackage{listings}
    
\definecolor{codegray}{gray}{0.9}
\definecolor{darkblue}{rgb}{0,0,0.6}
\definecolor{darkgreen}{rgb}{0,0.5,0}
\definecolor{darkred}{rgb}{0.6,0,0}

%% LISTINGS (ahaahha there ill be a lot :)
\lstdefinestyle{xmlstyle}{
    % language=XML,
    basicstyle=\sffamily\scriptsize,
    columns=flexible,
    % numbers=left,
    % numberstyle=\tiny\color{gray},
    stepnumber=1,
    % numbersep=5pt,
    % backgroundcolor=\color{codegray},
    showspaces=false,
    showstringspaces=false,
    breaklines=true,
    frame=single,
    morekeywords={version, encoding, type},
    keywordstyle=\bfseries, % \color{darkblue},
    stringstyle=\bfseries, % \color{darkred},
    commentstyle=\itshape\color{gray}
}

\renewcommand{\labelitemi}{$\textcolor{chaptergrey}{\circ}$}
\renewcommand{\labelitemii}{$\textcolor{chaptergrey}{\circ}$}
\renewcommand{\labelitemiii}{$\textcolor{chaptergrey}{\circ}$}
\renewcommand{\labelitemiv}{$\textcolor{chaptergrey}{\circ}$}

% \lstset{title={\lstname}}

\newif\ifdraft
\draftfalse


\usepackage{eso-pic}
\usepackage{duerer}

\renewcommand{\floatpagefraction}{.9}%


\newenvironment{abbreviations}[1][.5em]{
\par\vspace{#1}\noindent\begin{tabular}{@{}>{\bfseries}p{0.2\linewidth}@{\hspace{0.025\linewidth}}p{0.775\linewidth}@{}}
}{
\end{tabular}
}